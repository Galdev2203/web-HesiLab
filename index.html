<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Hesilab</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
    }
    .admin-btn {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
    section {
      padding: 20px;
    }
    .admin-section {
      display: none;
      background: #ecf0f1;
      padding: 20px;
      border: 2px solid #2c3e50;
      margin-top: 20px;
    }
    .login-box {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      max-width: 300px;
    }
    input[type="password"], input[type="button"] {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
    }
    .data-item {
      background: #f9f9f9;
      padding: 10px;
      margin: 10px 0;
      border-left: 3px solid #3498db;
    }
    .data-item strong {
      color: #2c3e50;
    }
    .error-message {
      background: #e74c3c;
      color: white;
      padding: 15px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .success-message {
      background: #27ae60;
      color: white;
      padding: 15px;
      margin-top: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Hesilab</h1>
    <!-- Bot√≥n de admin arriba a la derecha -->
    <button class="admin-btn" onclick="showAdminLogin()" title="Acceso Admin">üë§</button>
  </header>

  <!-- Secci√≥n p√∫blica -->
  <section id="publicSection">
    <h2>Secci√≥n P√∫blica</h2>
    <p>Bienvenido a Hesilab. Aqu√≠ puedes mostrar informaci√≥n general, noticias o lo que quieras.</p>
  </section>

  <!-- Login para administradores -->
  <section id="loginSection" style="display:none;">
    <h2>Acceso Administradores</h2>
    <div class="login-box">
      <label for="password">Introduce la contrase√±a:</label>
      <input type="password" id="password" placeholder="Contrase√±a">
      <input type="button" value="Entrar" onclick="checkPassword()">
    </div>
  </section>

  <!-- Panel privado -->
  <section class="admin-section" id="adminSection">
    <h3>Panel de Administraci√≥n</h3>
    <p>Bienvenido administrador. Aqu√≠ puedes gestionar la web, a√±adir contenido o configurar opciones.</p>
    
    <div style="margin-top: 30px;">
      <h4>Web Scraping</h4>
      <input type="text" id="urlInput" placeholder="URL a scrapear" style="width: 60%; padding: 10px;">
      <button onclick="executeWebScraping()" style="padding: 10px 20px; background: #27ae60; color: white; border: none; cursor: pointer;">
        üîç Ejecutar Scraping
      </button>
      
      <div id="loadingIndicator" style="display: none; margin-top: 15px; color: #3498db;">
        ‚è≥ Obteniendo datos...
      </div>
      
      <div id="resultsContainer" style="margin-top: 20px; background: white; padding: 15px; border: 1px solid #ccc; max-height: 500px; overflow-y: auto;">
        <p style="color: #7f8c8d;">Los resultados aparecer√°n aqu√≠...</p>
      </div>
    </div>
  </section>

  <script>
    function showAdminLogin() {
      document.getElementById("publicSection").style.display = "none";
      document.getElementById("loginSection").style.display = "block";
    }

    function checkPassword() {
      const password = document.getElementById("password").value;
      if (password === "hesilab123") { // Contrase√±a de ejemplo
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("adminSection").style.display = "block";
        alert("Acceso concedido");
      } else {
        alert("Contrase√±a incorrecta");
      }
    }

    async function executeWebScraping() {
      const urlInput = document.getElementById('urlInput').value;
      const loadingIndicator = document.getElementById('loadingIndicator');
      const resultsContainer = document.getElementById('resultsContainer');
      
      // Validar URL
      if (!urlInput) {
        resultsContainer.innerHTML = '<div class="error-message">‚ö†Ô∏è Por favor, introduce una URL v√°lida</div>';
        return;
      }

      // Mostrar indicador de carga
      loadingIndicator.style.display = 'block';
      resultsContainer.innerHTML = '<p style="color: #7f8c8d;">Procesando...</p>';

      try {
        // Opci√≥n 1: Scraping directo (puede fallar por CORS)
        const response = await fetch(urlInput);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const html = await response.text();
        
        // Parsear el HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Ejemplo de extracci√≥n de datos
        const title = doc.querySelector('title')?.textContent || 'Sin t√≠tulo';
        const h1Tags = Array.from(doc.querySelectorAll('h1')).map(h1 => h1.textContent);
        const h2Tags = Array.from(doc.querySelectorAll('h2')).map(h2 => h2.textContent);
        const paragraphs = Array.from(doc.querySelectorAll('p')).slice(0, 5).map(p => p.textContent);
        const links = Array.from(doc.querySelectorAll('a')).slice(0, 10).map(a => ({
          text: a.textContent.trim(),
          href: a.href
        }));
        const images = Array.from(doc.querySelectorAll('img')).slice(0, 5).map(img => ({
          src: img.src,
          alt: img.alt
        }));

        // Mostrar resultados
        displayResults({
          url: urlInput,
          title,
          h1Tags,
          h2Tags,
          paragraphs,
          links,
          images
        });

        loadingIndicator.style.display = 'none';

      } catch (error) {
        loadingIndicator.style.display = 'none';
        
        // Si falla por CORS, ofrecer alternativa
        resultsContainer.innerHTML = `
          <div class="error-message">
            <strong>‚ùå Error al obtener datos:</strong><br>
            ${error.message}<br><br>
            <strong>Posibles soluciones:</strong><br>
            1. La URL puede tener protecci√≥n CORS<br>
            2. Usa un proxy CORS: <code>https://api.allorigins.win/raw?url=${encodeURIComponent(urlInput)}</code><br>
            3. Implementa un backend con Node.js para el scraping<br><br>
            <button onclick="tryWithProxy('${urlInput}')" style="padding: 8px 15px; background: #3498db; color: white; border: none; cursor: pointer; border-radius: 3px;">
              üîÑ Intentar con Proxy CORS
            </button>
          </div>
        `;
      }
    }

    async function tryWithProxy(url) {
      const loadingIndicator = document.getElementById('loadingIndicator');
      const resultsContainer = document.getElementById('resultsContainer');
      
      loadingIndicator.style.display = 'block';
      resultsContainer.innerHTML = '<p style="color: #7f8c8d;">Intentando con proxy CORS...</p>';

      try {
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
        const response = await fetch(proxyUrl);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        const title = doc.querySelector('title')?.textContent || 'Sin t√≠tulo';
        const h1Tags = Array.from(doc.querySelectorAll('h1')).map(h1 => h1.textContent);
        const h2Tags = Array.from(doc.querySelectorAll('h2')).map(h2 => h2.textContent);
        const paragraphs = Array.from(doc.querySelectorAll('p')).slice(0, 5).map(p => p.textContent);
        const links = Array.from(doc.querySelectorAll('a')).slice(0, 10).map(a => ({
          text: a.textContent.trim(),
          href: a.href
        }));
        const images = Array.from(doc.querySelectorAll('img')).slice(0, 5).map(img => ({
          src: img.src,
          alt: img.alt
        }));

        displayResults({
          url,
          title,
          h1Tags,
          h2Tags,
          paragraphs,
          links,
          images
        });

        loadingIndicator.style.display = 'none';

      } catch (error) {
        loadingIndicator.style.display = 'none';
        resultsContainer.innerHTML = `
          <div class="error-message">
            <strong>‚ùå Error con proxy:</strong><br>
            ${error.message}
          </div>
        `;
      }
    }

    function displayResults(data) {
      const resultsContainer = document.getElementById('resultsContainer');
      
      let html = `
        <div class="success-message">
          ‚úÖ Datos obtenidos correctamente de: <strong>${data.url}</strong>
        </div>
        
        <div class="data-item">
          <strong>üìÑ T√≠tulo de la p√°gina:</strong><br>
          ${data.title}
        </div>
      `;

      if (data.h1Tags && data.h1Tags.length > 0) {
        html += `
          <div class="data-item">
            <strong>üìå Encabezados H1 (${data.h1Tags.length}):</strong><br>
            <ul>
              ${data.h1Tags.map(h1 => `<li>${h1.substring(0, 100)}</li>`).join('')}
            </ul>
          </div>
        `;
      }

      if (data.h2Tags && data.h2Tags.length > 0) {
        html += `
          <div class="data-item">
            <strong>üìç Encabezados H2 (${data.h2Tags.length}):</strong><br>
            <ul>
              ${data.h2Tags.slice(0, 10).map(h2 => `<li>${h2.substring(0, 100)}</li>`).join('')}
            </ul>
          </div>
        `;
      }

      if (data.paragraphs && data.paragraphs.length > 0) {
        html += `
          <div class="data-item">
            <strong>üìù Primeros p√°rrafos:</strong><br>
            ${data.paragraphs.map((p, i) => `<p><em>P√°rrafo ${i+1}:</em> ${p.substring(0, 150)}${p.length > 150 ? '...' : ''}</p>`).join('')}
          </div>
        `;
      }

      if (data.links && data.links.length > 0) {
        html += `
          <div class="data-item">
            <strong>üîó Enlaces encontrados (${data.links.length}):</strong><br>
            <ul>
              ${data.links.map(link => `<li><a href="${link.href}" target="_blank">${link.text || 'Sin texto'}</a></li>`).join('')}
            </ul>
          </div>
        `;
      }

      if (data.images && data.images.length > 0) {
        html += `
          <div class="data-item">
            <strong>üñºÔ∏è Im√°genes encontradas (${data.images.length}):</strong><br>
            <ul>
              ${data.images.map(img => `<li>${img.alt || 'Sin descripci√≥n'} - <code>${img.src}</code></li>`).join('')}
            </ul>
          </div>
        `;
      }

      resultsContainer.innerHTML = html;
    }
  </script>
</body>
</html>
